<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>FMWA Admin Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
<style>
        body { padding-top: 40px; }
        .section { margin-bottom: 40px; }
    </style>
</head>
<body>
<div class="container">
<!-- Nav tabs -->
<ul class="nav nav-pills mb-4" id="adminTabs" role="tablist">
<li class="nav-item" role="presentation">
<button class="nav-link active" data-bs-target="#media" data-bs-toggle="pill" id="media-tab" role="tab" type="button">Media</button>
</li>
<li class="nav-item" role="presentation">
<button class="nav-link" data-bs-target="#news" data-bs-toggle="pill" id="news-tab" role="tab" type="button">News</button>
</li>
<li class="nav-item" role="presentation">
<button class="nav-link" data-bs-target="#writeups" data-bs-toggle="pill" id="writeup-tab" role="tab" type="button">Write-ups</button>
</li>
<li class="nav-item" role="presentation">
<button class="nav-link" data-bs-target="#pages" data-bs-toggle="pill" id="pages-tab" role="tab" type="button">Pages</button>
</li>
</ul>
<div class="tab-content">
<h1 class="mb-4">Admin Dashboard</h1>
<!-- MEDIA TAB -->
<div class="tab-pane fade show active" id="media" role="tabpanel">
<h2>Upload Media</h2>
<div class="section">
<h2>Upload Media</h2>
<form id="mediaForm">
<div class="mb-3">
<label class="form-label" for="media">Select File</label>
<input accept="image/*,video/*" class="form-control" id="media" name="media" required="" type="file"/>
</div>
<button class="btn btn-primary" type="submit">Upload</button>
</form>
<div class="mt-2" id="mediaResult"></div>
</div>
</div>
<!-- NEWS TAB -->
<div class="tab-pane fade" id="news" role="tabpanel">
<h2>Add News Article</h2>
<div class="section">
<h2>Add News Article</h2>
<form id="newsForm">
<div class="mb-3">
<label class="form-label" for="newsTitle">Title</label>
<input class="form-control" id="newsTitle" name="title" required="" type="text"/>
</div>
<div class="mb-3">
<label class="form-label" for="newsContent">Content</label>
<textarea class="form-control" id="newsContent" name="content" required="" rows="4"></textarea>
</div>
<button class="btn btn-success" type="submit">Save News</button>
</form>
<div class="mt-2" id="newsResult"></div>
</div>
</div>
<!-- WRITE-UP TAB -->
<div class="tab-pane fade" id="writeups" role="tabpanel">
<h2>Add Write-up</h2>
<div class="section">
<h2>Add Write-up</h2>
<form id="writeupForm">
<div class="mb-3">
<label class="form-label" for="writeupTitle">Title</label>
<input class="form-control" id="writeupTitle" name="title" required="" type="text"/>
</div>
<div class="mb-3">
<label class="form-label" for="writeupContent">Content</label>
<textarea class="form-control" id="writeupContent" name="content" required="" rows="4"></textarea>
</div>
<button class="btn btn-success" type="submit">Save Write-up</button>
</form>
<div class="mt-2" id="writeupResult"></div>
</div>
<!-- PAGES TAB -->
<div class="tab-pane fade" id="pages" role="tabpanel">
<div class="row">
<div class="col-md-4">
<h3>Site Pages</h3>
<h5>General Pages</h5>
<ul class="list-group mb-3" id="generalPages"></ul>
<h5>Department Pages</h5>
<ul class="list-group" id="deptPages"></ul>
</div>
<div class="col-md-8">
<h3 id="editorTitle">Editor</h3>
<label class="form-label" for="pageContent">Page HTML Source</label>
<textarea class="form-control" id="pageContent" placeholder="Edit HTML here" rows="20"></textarea>
<button class="btn btn-primary mt-2" id="savePageBtn">Save Changes</button>
<div class="mt-2" id="pageResult"></div>
</div>
</div>
</div>
</div> <!-- tab-content end -->
</div> <!-- container end -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Helper to show messages
function showMessage(el, msg, success=true){
    el.textContent = msg;
    el.className = success ? 'text-success' : 'text-danger';
}

// Media upload
const mediaForm = document.getElementById('mediaForm');
mediaForm.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const mediaInput = document.getElementById('media');
    const formData = new FormData();
    formData.append('media', mediaInput.files[0]);
    try {
        const res = await fetch('/api/upload', {
            method:'POST',
            body: formData
        });
        const data = await res.json();
        if(data.success){
            showMessage(document.getElementById('mediaResult'), `Uploaded! URL: ${data.url}`);
            mediaForm.reset();
        }else throw new Error(data.message);
    }catch(err){
        showMessage(document.getElementById('mediaResult'), err.message, false);
    }
});

// News save
const newsForm = document.getElementById('newsForm');
newsForm.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const payload = {
        title: newsForm.title.value,
        content: newsForm.content.value
    };
    try {
        const res = await fetch('/api/news', {
            method:'POST',
            headers:{ 'Content-Type':'application/json' },
            body: JSON.stringify(payload)
        });
        const data = await res.json();
        if(data.success){
            showMessage(document.getElementById('newsResult'), 'News saved successfully');
            newsForm.reset();
        }else throw new Error(data.message);
    }catch(err){
        showMessage(document.getElementById('newsResult'), err.message, false);
    }
});

// Writeup save
const writeupForm = document.getElementById('writeupForm');
writeupForm.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const payload = {
        title: writeupForm.title.value,
        content: writeupForm.content.value
    };
    try {
        const res = await fetch('/api/writeups', {
            method:'POST',
            headers:{ 'Content-Type':'application/json' },
            body: JSON.stringify(payload)
        });
        const data = await res.json();
        if(data.success){
            showMessage(document.getElementById('writeupResult'), 'Write-up saved successfully');
            writeupForm.reset();
        }else throw new Error(data.message);
    }catch(err){
        showMessage(document.getElementById('writeupResult'), err.message, false);
    }
});
// ---------------- PAGES TAB LOGIC ----------------
async function loadPageList(){
    const res = await fetch('/api/pages');
    const data = await res.json();
    if(!data.success) return;
    const gen = document.getElementById('generalPages');
    const dept = document.getElementById('deptPages');
    gen.innerHTML='';
    dept.innerHTML='';
    data.pages.forEach(p=>{
        const li = document.createElement('li');
        li.className='list-group-item list-group-item-action';
        li.textContent=p;
        li.style.cursor='pointer';
        li.addEventListener('click', ()=>loadPage(p));
        const targetList = p.startsWith('departments/') ? dept : gen;
        targetList.appendChild(li);
    });
}


async function loadPage(path){
    const res = await fetch('/api/page?path='+encodeURIComponent(path));
    const data = await res.json();
    if(data.success){
        document.getElementById('pageContent').value=data.content;
        document.getElementById('editorTitle').textContent='Editing '+path;
        document.getElementById('savePageBtn').dataset.path=path;
    }
}

document.getElementById('savePageBtn').addEventListener('click', async ()=>{
    const path = document.getElementById('savePageBtn').dataset.path;
    if(!path) return;
    const content = document.getElementById('pageContent').value;
    const res = await fetch('/api/page', {
        method:'POST',
        headers:{ 'Content-Type':'application/json' },
        body: JSON.stringify({ path, content })
    });
    const data = await res.json();
    showMessage(document.getElementById('pageResult'), data.success? 'Saved!': (data.message||'Error'), data.success);
});

// Load list on tab shown
const pagesTab = document.getElementById('pages-tab');
pagesTab.addEventListener('shown.bs.tab', loadPageList);

</script>
</div></body>
</html>
